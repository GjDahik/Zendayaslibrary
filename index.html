<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Biblioteca de Zendaya</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Crimson+Text:ital@0;1&display=swap');
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: 'Crimson Text', serif;
      min-height: 100vh;
      color: #e8e0d5;
      background: linear-gradient(180deg, #1a1520 0%, #0f0a15 50%, #0a0510 100%);
      padding: 20px;
    }
    
    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: 
        radial-gradient(ellipse at 30% 20%, rgba(100,60,120,0.1) 0%, transparent 50%),
        radial-gradient(ellipse at 70% 80%, rgba(60,40,80,0.15) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }
    
    .container {
      max-width: 1100px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }
    
    header {
      text-align: center;
      padding: 40px 20px;
    }
    
    .header-icon { font-size: 4em; margin-bottom: 15px; filter: drop-shadow(0 0 20px rgba(150,100,200,0.5)); }
    
    h1 {
      font-family: 'Cinzel', serif;
      font-size: 2.8em;
      color: #c9a0dc;
      text-shadow: 0 0 20px rgba(200,160,220,0.4), 0 4px 8px rgba(0,0,0,0.8);
      letter-spacing: 6px;
      margin-bottom: 10px;
    }
    
    .subtitle { font-family: 'Cinzel', serif; color: #8a7a9a; font-size: 1.1em; letter-spacing: 3px; }
    
    .rules-box {
      background: linear-gradient(135deg, rgba(80,40,60,0.3), rgba(40,20,40,0.5));
      border: 2px solid #5a3a4a;
      border-radius: 10px;
      padding: 25px;
      margin-bottom: 30px;
    }
    
    .rules-title { font-family: 'Cinzel', serif; color: #dc9a9a; font-size: 1.3em; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
    .rules-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 10px; }
    .rule-item { display: flex; align-items: center; gap: 10px; color: #b0a0a0; font-size: 0.95em; }
    .rule-icon { color: #c9a0dc; }
    
    .tabs { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 25px; justify-content: center; }
    
    .tab-btn {
      padding: 10px 18px;
      border: 2px solid #4a3a5a;
      border-radius: 5px;
      background: rgba(60,40,70,0.3);
      color: #a090b0;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'Cinzel', serif;
      font-size: 0.85em;
      letter-spacing: 1px;
    }
    
    .tab-btn:hover { border-color: #8a6a9a; color: #c9a0dc; }
    .tab-btn.active { background: rgba(150,100,180,0.2); border-color: #c9a0dc; color: #e0c0f0; box-shadow: 0 0 15px rgba(200,160,220,0.3); }
    
    .section { display: none; }
    .section.active { display: block; }
    
    .section-header { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid rgba(200,160,220,0.2); }
    .section-icon { font-size: 2.5em; }
    .section-title { font-family: 'Cinzel', serif; font-size: 1.6em; color: #c9a0dc; }
    .section-desc { color: #8a7a9a; font-style: italic; margin-top: 5px; font-size: 0.95em; }
    
    .books-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; margin-bottom: 20px; }
    
    .book-card {
      background: linear-gradient(135deg, rgba(50,30,60,0.6), rgba(30,20,40,0.8));
      border: 2px solid #4a3a5a;
      border-radius: 10px;
      padding: 20px;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }
    
    .book-card::before { content: ""; position: absolute; top: 0; left: 0; width: 5px; height: 100%; background: var(--book-color, #8a6a9a); }
    .book-card:hover { border-color: var(--book-color, #8a6a9a); transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.4), 0 0 20px var(--book-glow, rgba(138,106,154,0.2)); }
    
    .book-title { font-family: 'Cinzel', serif; font-size: 1.15em; color: #e0d0e8; margin-bottom: 12px; padding-right: 10px; }
    .book-details { display: flex; flex-direction: column; gap: 8px; }
    .book-row { display: flex; justify-content: space-between; align-items: center; font-size: 0.9em; }
    .book-label { color: #8a7a9a; }
    .book-value { color: #c9b0d0; font-weight: 500; }
    
    .book-effect { background: rgba(200,160,220,0.1); border-radius: 5px; padding: 10px; margin-top: 10px; border-left: 3px solid var(--book-color, #8a6a9a); }
    .effect-label { color: #a090a8; font-size: 0.8em; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; }
    .effect-text { color: #d0c0e0; font-size: 0.95em; }
    
    .add-btn {
      margin-top: 12px;
      width: 100%;
      padding: 10px;
      background: linear-gradient(135deg, rgba(100,60,140,0.4), rgba(80,40,100,0.6));
      border: 2px solid #6a4a8a;
      border-radius: 5px;
      color: #d0c0e0;
      cursor: pointer;
      font-family: 'Cinzel', serif;
      font-size: 0.9em;
      transition: all 0.3s;
    }
    
    .add-btn:hover { background: rgba(150,100,180,0.4); border-color: #c9a0dc; color: #fff; }
    .add-btn.added { background: rgba(50,150,50,0.3); border-color: #5a9a5a; color: #8fbc8f; }
    
    .magic { --book-color: #7b68ee; --book-glow: rgba(123,104,238,0.3); }
    .craft { --book-color: #cd853f; --book-glow: rgba(205,133,63,0.3); }
    .cooking { --book-color: #e9967a; --book-glow: rgba(233,150,122,0.3); }
    .traps { --book-color: #708090; --book-glow: rgba(112,128,144,0.3); }
    .alchemy { --book-color: #32cd32; --book-glow: rgba(50,205,50,0.3); }
    .maps { --book-color: #daa520; --book-glow: rgba(218,165,32,0.3); }
    .restricted { --book-color: #dc143c; --book-glow: rgba(220,20,60,0.4); }
    
    .restricted .book-card { border-color: #5a2a3a; background: linear-gradient(135deg, rgba(60,20,30,0.6), rgba(30,10,20,0.8)); }
    .censored .book-title { color: #8b0000; letter-spacing: 2px; text-shadow: 0 0 8px rgba(139,0,0,0.5); }
    .censored-text { color: #6a0000 !important; letter-spacing: 1px; font-family: monospace; }
    
    .section-note { background: rgba(100,80,120,0.2); border: 1px solid #5a4a6a; border-radius: 8px; padding: 15px 20px; margin-top: 20px; display: flex; align-items: flex-start; gap: 12px; }
    .note-icon { font-size: 1.3em; color: #c9a0dc; }
    .note-text { color: #a090b0; font-size: 0.9em; line-height: 1.5; }
    
    .info-box { display: flex; gap: 15px; flex-wrap: wrap; margin-top: 15px; }
    .info-tag { background: rgba(80,60,100,0.3); border: 1px solid #5a4a6a; border-radius: 20px; padding: 8px 15px; font-size: 0.85em; color: #b0a0c0; }
    .info-tag strong { color: #d0c0e0; }
    
    .restricted-warning { background: linear-gradient(135deg, rgba(100,20,30,0.3), rgba(60,10,20,0.4)); border: 2px solid #8b0000; border-radius: 10px; padding: 20px; margin-bottom: 20px; text-align: center; }
    .warning-icon { font-size: 2em; margin-bottom: 10px; }
    .warning-title { font-family: 'Cinzel', serif; color: #ff6b6b; font-size: 1.2em; margin-bottom: 10px; }
    .warning-text { color: #c08080; font-size: 0.9em; }
    
    /* CARRITO */
    .cart-btn {
      position: fixed;
      bottom: 30px;
      right: 30px;
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: linear-gradient(135deg, #6a4a8a, #4a2a6a);
      border: 3px solid #c9a0dc;
      color: #fff;
      font-size: 1.8em;
      cursor: pointer;
      box-shadow: 0 5px 25px rgba(100,60,140,0.5);
      z-index: 100;
      transition: all 0.3s;
    }
    
    .cart-btn:hover { transform: scale(1.1); box-shadow: 0 5px 35px rgba(150,100,200,0.6); }
    
    .cart-count {
      position: absolute;
      top: -5px;
      right: -5px;
      background: #dc143c;
      color: #fff;
      width: 26px;
      height: 26px;
      border-radius: 50%;
      font-size: 0.5em;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
    }
    
    .cart-modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      z-index: 200;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    
    .cart-modal.open { display: flex; }
    
    .cart-content {
      background: linear-gradient(135deg, #2a1a3a, #1a1020);
      border: 3px solid #6a4a8a;
      border-radius: 15px;
      padding: 30px;
      max-width: 500px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
    }
    
    .cart-close {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      color: #a090b0;
      font-size: 1.5em;
      cursor: pointer;
    }
    
    .cart-close:hover { color: #fff; }
    
    .cart-title { font-family: 'Cinzel', serif; color: #c9a0dc; font-size: 1.5em; margin-bottom: 20px; text-align: center; }
    
    .cart-empty { text-align: center; color: #8a7a9a; padding: 40px 0; font-style: italic; }
    
    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: rgba(80,50,100,0.2);
      border-radius: 8px;
      margin-bottom: 10px;
      border-left: 3px solid #7b68ee;
    }
    
    .cart-item-info { flex: 1; }
    .cart-item-name { color: #e0d0e8; font-size: 0.95em; margin-bottom: 3px; }
    .cart-item-price { color: #daa520; font-size: 0.85em; }
    
    .cart-item-remove {
      background: rgba(150,50,50,0.3);
      border: 1px solid #8b4040;
      color: #ff6b6b;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.1em;
      transition: all 0.2s;
    }
    
    .cart-item-remove:hover { background: rgba(200,50,50,0.5); }
    
    .cart-total {
      border-top: 2px solid #5a4a6a;
      margin-top: 20px;
      padding-top: 15px;
      display: flex;
      justify-content: space-between;
      font-family: 'Cinzel', serif;
      font-size: 1.2em;
    }
    
    .cart-total-label { color: #a090b0; }
    .cart-total-value { color: #daa520; }
    
    .cart-checkout {
      width: 100%;
      margin-top: 20px;
      padding: 15px;
      background: linear-gradient(135deg, #5a3a7a, #3a2a5a);
      border: 2px solid #8a6aaa;
      border-radius: 8px;
      color: #e0d0f0;
      font-family: 'Cinzel', serif;
      font-size: 1.1em;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .cart-checkout:hover { background: linear-gradient(135deg, #7a5a9a, #5a4a7a); border-color: #c9a0dc; }
    .cart-checkout:disabled { opacity: 0.5; cursor: not-allowed; }
    
    /* RECIBO */
    .receipt {
      background: #f5f0e6;
      color: #2a2020;
      padding: 30px;
      border-radius: 5px;
      font-family: 'Courier New', monospace;
      box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    }
    
    .receipt-header { text-align: center; border-bottom: 2px dashed #8a7a6a; padding-bottom: 15px; margin-bottom: 15px; }
    .receipt-logo { font-size: 2.5em; margin-bottom: 5px; }
    .receipt-title { font-size: 1.3em; font-weight: bold; color: #4a3a5a; letter-spacing: 2px; }
    .receipt-subtitle { font-size: 0.85em; color: #6a5a5a; margin-top: 5px; }
    
    .receipt-body { margin: 15px 0; }
    
    .receipt-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dotted #c0b0a0; }
    .receipt-item-name { flex: 1; color: #3a3030; }
    .receipt-item-price { color: #5a4a3a; font-weight: bold; }
    
    .receipt-total { display: flex; justify-content: space-between; padding: 15px 0; border-top: 2px solid #8a7a6a; margin-top: 10px; font-size: 1.2em; font-weight: bold; }
    .receipt-total-label { color: #4a3a5a; }
    .receipt-total-value { color: #8b4513; }
    
    .receipt-footer { text-align: center; margin-top: 20px; padding-top: 15px; border-top: 2px dashed #8a7a6a; }
    .receipt-warning { background: #fff3cd; border: 2px solid #d4a020; padding: 15px; border-radius: 5px; margin-bottom: 15px; }
    .receipt-warning-icon { font-size: 1.5em; }
    .receipt-warning-text { font-size: 0.9em; color: #6a5a00; margin-top: 5px; font-weight: bold; }
    .receipt-date { font-size: 0.8em; color: #7a6a6a; }
    .receipt-thanks { font-size: 0.9em; color: #5a4a5a; margin-top: 10px; font-style: italic; }
    
    .receipt-close {
      width: 100%;
      margin-top: 20px;
      padding: 12px;
      background: #4a3a5a;
      border: none;
      border-radius: 5px;
      color: #fff;
      font-size: 1em;
      cursor: pointer;
    }
    
    .receipt-close:hover { background: #6a5a7a; }
    
    @media (max-width: 600px) {
      h1 { font-size: 1.8em; letter-spacing: 3px; }
      .header-icon { font-size: 3em; }
      .books-grid { grid-template-columns: 1fr; }
      .tab-btn { padding: 8px 12px; font-size: 0.75em; }
      .rules-grid { grid-template-columns: 1fr; }
      .section-title { font-size: 1.3em; }
      .cart-btn { width: 60px; height: 60px; font-size: 1.5em; bottom: 20px; right: 20px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="header-icon">üìö</div>
      <h1>Biblioteca de Zendaya</h1>
      <p class="subtitle">Cat√°logo General</p>
    </header>
    
    <div class="rules-box">
      <div class="rules-title">üîí Reglas de la Biblioteca</div>
      <div class="rules-grid">
        <div class="rule-item"><span class="rule-icon">üìÖ</span> Alquiler m√≠nimo: 1 semana</div>
        <div class="rule-item"><span class="rule-icon">üåô</span> Lectura: solo durante descansos</div>
        <div class="rule-item"><span class="rule-icon">‚è≥</span> Sin completar tiempo ‚Üí no se aprende</div>
        <div class="rule-item"><span class="rule-icon">‚ú®</span> Todo lo aprendido es permanente</div>
        <div class="rule-item"><span class="rule-icon">üìñ</span> El libro ense√±a, no regala materiales</div>
        <div class="rule-item"><span class="rule-icon">üí∞</span> Dep√≥sito devuelto si el libro vuelve intacto</div>
      </div>
    </div>
    
    <div class="tabs">
      <button class="tab-btn active" data-section="magia">‚ú® Magia</button>
      <button class="tab-btn" data-section="fabricacion">‚öîÔ∏è Fabricaci√≥n</button>
      <button class="tab-btn" data-section="cocina">üç≤ Cocina</button>
      <button class="tab-btn" data-section="trampas">‚öôÔ∏è Trampas</button>
      <button class="tab-btn" data-section="alquimia">üß™ Alquimia</button>
      <button class="tab-btn" data-section="mapas">üó∫Ô∏è Mapas</button>
      <button class="tab-btn" data-section="restringida">üîí Restringida</button>
    </div>
    
    <div id="magia" class="section active">
      <div class="section-header">
        <span class="section-icon">‚ú®</span>
        <div><h2 class="section-title">Secci√≥n de Magia</h2><p class="section-desc">Conjuros oficiales D&D 5e</p></div>
      </div>
      <div class="books-grid" id="books-magia"></div>
    </div>
    
    <div id="fabricacion" class="section">
      <div class="section-header">
        <span class="section-icon">‚öîÔ∏è</span>
        <div><h2 class="section-title">Secci√≥n de Fabricaci√≥n</h2><p class="section-desc">Armas y Armaduras</p></div>
      </div>
      <div class="info-box"><span class="info-tag"><strong>Dep√≥sito:</strong> 35‚Äì70 PO</span><span class="info-tag"><strong>Tiempo:</strong> 2‚Äì4 DL</span></div>
      <div class="books-grid" id="books-fabricacion" style="margin-top:20px;"></div>
      <div class="section-note"><span class="note-icon">üìå</span><span class="note-text">El libro habilita fabricar, no reduce costos ni tiempos de fabricaci√≥n.</span></div>
    </div>
    
    <div id="cocina" class="section">
      <div class="section-header">
        <span class="section-icon">üç≤</span>
        <div><h2 class="section-title">Secci√≥n de Cocina</h2><p class="section-desc">Comida con efectos (tipo poci√≥n)</p></div>
      </div>
      <div class="info-box"><span class="info-tag"><strong>Dep√≥sito:</strong> 25‚Äì60 PO</span><span class="info-tag"><strong>Tiempo:</strong> 2‚Äì4 DL</span></div>
      <div class="books-grid" id="books-cocina" style="margin-top:20px;"></div>
    </div>
    
    <div id="trampas" class="section">
      <div class="section-header">
        <span class="section-icon">‚öôÔ∏è</span>
        <div><h2 class="section-title">Secci√≥n de Trampas y Mec√°nica</h2><p class="section-desc">Construcci√≥n de dispositivos</p></div>
      </div>
      <div class="info-box"><span class="info-tag"><strong>Dep√≥sito:</strong> 40‚Äì80 PO</span><span class="info-tag"><strong>Tiempo:</strong> 3‚Äì4 DL</span></div>
      <div class="books-grid" id="books-trampas" style="margin-top:20px;"></div>
    </div>
    
    <div id="alquimia" class="section">
      <div class="section-header">
        <span class="section-icon">üß™</span>
        <div><h2 class="section-title">Secci√≥n de Alquimia</h2><p class="section-desc">Pociones y consumibles</p></div>
      </div>
      <div class="info-box"><span class="info-tag"><strong>Dep√≥sito:</strong> 40‚Äì90 PO</span><span class="info-tag"><strong>Tiempo:</strong> 3‚Äì5 DL</span></div>
      <div class="books-grid" id="books-alquimia" style="margin-top:20px;"></div>
    </div>
    
    <div id="mapas" class="section">
      <div class="section-header">
        <span class="section-icon">üó∫Ô∏è</span>
        <div><h2 class="section-title">Secci√≥n de Mapas y Exploraci√≥n</h2><p class="section-desc">Conocimiento geogr√°fico</p></div>
      </div>
      <div class="info-box"><span class="info-tag"><strong>Dep√≥sito:</strong> 20‚Äì90 PO</span><span class="info-tag"><strong>Tiempo:</strong> 2‚Äì4 DL</span></div>
      <div class="books-grid" id="books-mapas" style="margin-top:20px;"></div>
      <div class="section-note"><span class="note-icon">üìå</span><span class="note-text">El DM traduce el efecto a exploraci√≥n real (menos encuentros, rutas claras, etc.).</span></div>
    </div>
    
    <div id="restringida" class="section restricted">
      <div class="section-header">
        <span class="section-icon">üîí</span>
        <div><h2 class="section-title">Secci√≥n Restringida</h2><p class="section-desc">Alto impacto ‚Äî Acceso limitado</p></div>
      </div>
      <div class="restricted-warning">
        <div class="warning-icon">‚ö†Ô∏è</div>
        <div class="warning-title">ACCESO DENEGADO</div>
        <div class="warning-text">Esta secci√≥n requiere autorizaci√≥n especial de la bibliotecaria Zendaya.</div>
      </div>
      <div class="info-box"><span class="info-tag"><strong>Dep√≥sito:</strong> XXX‚ÄìXXX PO</span><span class="info-tag"><strong>Tiempo:</strong> X‚ÄìX DL</span></div>
      <div class="books-grid" id="books-restringida" style="margin-top:20px;"></div>
    </div>
  </div>
  
  <button class="cart-btn" id="cartBtn">üõí<span class="cart-count" id="cartCount">0</span></button>
  
  <div class="cart-modal" id="cartModal">
    <div class="cart-content" id="cartContent"></div>
  </div>
  
  <script>
    const books = {
      magia: [
        { id: 'm1', title: 'Manual del Aprendiz Arcano', nivel: 1, deposito: 25, tiempo: '3 DL', efLabel: 'Conjuro aprendido', efecto: 'Detect Magic', css: 'magic' },
        { id: 'm2', title: 'Rituales de Protecci√≥n Menor', nivel: 1, deposito: 30, tiempo: '3 DL', efLabel: 'Conjuro aprendido', efecto: 'Alarm (ritual)', css: 'magic' },
        { id: 'm3', title: 'Tratado √çgneo B√°sico', nivel: 1, deposito: 40, tiempo: '3 DL', efLabel: 'Conjuro aprendido', efecto: 'Burning Hands', css: 'magic' },
        { id: 'm4', title: 'Ilusiones Cotidianas', nivel: 1, deposito: 40, tiempo: '3 DL', efLabel: 'Conjuro aprendido', efecto: 'Disguise Self', css: 'magic' },
        { id: 'm5', title: 'Vol√∫menes de Invocaci√≥n Natural', nivel: 1, deposito: 50, tiempo: '4 DL', efLabel: 'Conjuro aprendido', efecto: 'Find Familiar', css: 'magic' },
        { id: 'm6', title: 'Principios de Curaci√≥n Pr√°ctica', nivel: 1, deposito: 45, tiempo: '4 DL', efLabel: 'Conjuro aprendido', efecto: 'Cure Wounds', css: 'magic' }
      ],
      fabricacion: [
        { id: 'f1', title: 'Forja del Aventurero', deposito: 35, tiempo: '2 DL', efLabel: 'Permite fabricar', efecto: 'Armas simples ‚Üí Arma est√°ndar D&D', css: 'craft' },
        { id: 'f2', title: 'Tratado del Acero Balanceado', deposito: 50, tiempo: '3 DL', efLabel: 'Permite fabricar', efecto: 'Armas marciales ‚Üí Arma est√°ndar D&D', css: 'craft' },
        { id: 'f3', title: 'Manual de Protecci√≥n Ligera', deposito: 45, tiempo: '3 DL', efLabel: 'Permite fabricar', efecto: 'Armadura ligera ‚Üí AC normal', css: 'craft' },
        { id: 'f4', title: 'Gu√≠a de Placas y Remaches', deposito: 70, tiempo: '4 DL', efLabel: 'Permite fabricar', efecto: 'Armadura media ‚Üí AC normal', css: 'craft' }
      ],
      cocina: [
        { id: 'c1', title: 'Cocina del Caminante', deposito: 25, tiempo: '2 DL', efLabel: 'Prepara', efecto: 'Raci√≥n curativa ‚Üí Cura 2d4 + 2 PG', css: 'cooking' },
        { id: 'c2', title: 'Guisos de Recuperaci√≥n Profunda', deposito: 45, tiempo: '3 DL', efLabel: 'Prepara', efecto: 'Plato curativo ‚Üí Cura 4d4 + 4 PG', css: 'cooking' },
        { id: 'c3', title: 'Recetas del Fr√≠o Eterno', deposito: 40, tiempo: '3 DL', efLabel: 'Prepara', efecto: 'Comida t√©rmica ‚Üí Ignora fr√≠o extremo 24h', css: 'cooking' },
        { id: 'c4', title: 'Banquete del Refugio', deposito: 60, tiempo: '4 DL', efLabel: 'Prepara', efecto: 'Banquete (1‚Äì4 PJ) ‚Üí Cura 2d4 + 2 PG', css: 'cooking' }
      ],
      trampas: [
        { id: 't1', title: 'Trampas del Explorador', deposito: 40, tiempo: '3 DL', efLabel: 'Ense√±a a construir', efecto: 'Trampa de lazo ‚Üí Restringe', css: 'traps' },
        { id: 't2', title: 'Mecanismos de Presi√≥n', deposito: 55, tiempo: '3 DL', efLabel: 'Ense√±a a construir', efecto: 'Trampa de pinchos ‚Üí Da√±o perforante', css: 'traps' },
        { id: 't3', title: 'Engranajes y Resortes', deposito: 65, tiempo: '4 DL', efLabel: 'Ense√±a a construir', efecto: 'Trampa reutilizable ‚Üí Rearmable', css: 'traps' },
        { id: 't4', title: 'Manual del Saboteador', deposito: 80, tiempo: '4 DL', efLabel: 'Ense√±a a construir', efecto: 'Trampa explosiva menor ‚Üí Da√±o en √°rea', css: 'traps' }
      ],
      alquimia: [
        { id: 'a1', title: 'Alquimia del Iniciado', deposito: 40, tiempo: '3 DL', efLabel: 'Permite fabricar', efecto: 'Poci√≥n de Curaci√≥n ‚Üí 2d4 + 2', css: 'alchemy' },
        { id: 'a2', title: 'Destilados √ötiles', deposito: 50, tiempo: '3 DL', efLabel: 'Permite fabricar', efecto: 'Ant√≠doto ‚Üí Cura veneno', css: 'alchemy' },
        { id: 'a3', title: 'Extractos Vol√°tiles', deposito: 70, tiempo: '4 DL', efLabel: 'Permite fabricar', efecto: 'Fuego alqu√≠mico ‚Üí DMG', css: 'alchemy' },
        { id: 'a4', title: 'Compendio de Mezclas Mejoradas', deposito: 90, tiempo: '5 DL', efLabel: 'Permite fabricar', efecto: 'Poci√≥n superior ‚Üí 4d4 + 4', css: 'alchemy' }
      ],
      mapas: [
        { id: 'mp1', title: 'Atlas del Territorio Cercano', deposito: 20, tiempo: '2 DL', efLabel: 'Otorga', efecto: 'Ruta segura', css: 'maps' },
        { id: 'mp2', title: 'Planos Antiguos de Ruinas', deposito: 50, tiempo: '3 DL', efLabel: 'Otorga', efecto: 'Entrada alternativa', css: 'maps' },
        { id: 'mp3', title: 'Cartograf√≠a Olvidada', deposito: 70, tiempo: '4 DL', efLabel: 'Otorga', efecto: 'Sala oculta', css: 'maps' },
        { id: 'mp4', title: 'Mapas Malditos', deposito: 90, tiempo: '4 DL', efLabel: 'Otorga', efecto: 'Atajo peligroso', css: 'maps' }
      ],
      restringida: [
        { id: 'r1', title: 'XXXXXXXXXXXXXXXXXX', deposito: null, efLabel: 'Ense√±a', efecto: 'XXXXXXXXXXXX', css: 'restricted censored', censored: true },
        { id: 'r2', title: 'XXXXXXXXXXXXXXXXX', deposito: null, efLabel: 'Ense√±a', efecto: 'XXXX', css: 'restricted censored', censored: true },
        { id: 'r3', title: 'XXXXXXXXXXXXXXXXXXXXXXX', deposito: null, efLabel: 'Ense√±a', efecto: 'XXXXXXXXXXXXXXXXXXX', css: 'restricted censored', censored: true }
      ]
    };
    
    let cart = [];
    
    function renderBooks() {
      Object.keys(books).forEach(section => {
        const container = document.getElementById('books-' + section);
        if (!container) return;
        container.innerHTML = books[section].map(book => {
          const inCart = cart.find(c => c.id === book.id);
          return `
            <div class="book-card ${book.css}">
              <div class="book-title">${book.title}</div>
              <div class="book-details">
                ${book.nivel ? `<div class="book-row"><span class="book-label">Nivel</span><span class="book-value">${book.nivel}</span></div>` : ''}
                ${book.deposito ? `<div class="book-row"><span class="book-label">Dep√≥sito</span><span class="book-value">${book.deposito} PO</span></div>` : ''}
                ${book.tiempo ? `<div class="book-row"><span class="book-label">Tiempo</span><span class="book-value">${book.tiempo}</span></div>` : ''}
                ${book.censored ? `<div class="book-row"><span class="book-label">Consecuencia</span><span class="book-value censored-text">XXXXXXXXXX</span></div>` : ''}
              </div>
              <div class="book-effect">
                <div class="effect-label">${book.efLabel}</div>
                <div class="effect-text ${book.censored ? 'censored-text' : ''}">${book.efecto}</div>
              </div>
              ${!book.censored ? `<button class="add-btn ${inCart ? 'added' : ''}" data-id="${book.id}">${inCart ? '‚úì En el carrito' : '+ Agregar al carrito'}</button>` : ''}
            </div>
          `;
        }).join('');
      });
      document.querySelectorAll('.add-btn').forEach(btn => {
        btn.onclick = () => toggleCart(btn.dataset.id);
      });
    }
    
    function findBook(id) {
      for (let s of Object.values(books)) {
        const b = s.find(x => x.id === id);
        if (b) return b;
      }
      return null;
    }
    
    function toggleCart(id) {
      const idx = cart.findIndex(c => c.id === id);
      if (idx >= 0) cart.splice(idx, 1);
      else {
        const book = findBook(id);
        if (book && book.deposito) cart.push(book);
      }
      updateCartUI();
      renderBooks();
    }
    
    function updateCartUI() {
      document.getElementById('cartCount').textContent = cart.length;
    }
    
    function renderCartModal(showReceipt = false, receiptData = null) {
      const content = document.getElementById('cartContent');
      if (showReceipt && receiptData) {
        const now = new Date();
        const dateStr = now.toLocaleDateString('es-ES', { day: '2-digit', month: 'short', year: 'numeric' });
        const timeStr = now.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
        content.innerHTML = `
          <div class="receipt">
            <div class="receipt-header">
              <div class="receipt-logo">üìö</div>
              <div class="receipt-title">BIBLIOTECA DE ZENDAYA</div>
              <div class="receipt-subtitle">Recibo de Dep√≥sito</div>
            </div>
            <div class="receipt-body">
              ${receiptData.items.map(item => `
                <div class="receipt-item">
                  <span class="receipt-item-name">${item.title}</span>
                  <span class="receipt-item-price">${item.deposito} PO</span>
                </div>
              `).join('')}
            </div>
            <div class="receipt-total">
              <span class="receipt-total-label">DEP√ìSITO TOTAL:</span>
              <span class="receipt-total-value">${receiptData.total} PO</span>
            </div>
            <div class="receipt-footer">
              <div class="receipt-warning">
                <div class="receipt-warning-icon">‚ö†Ô∏è</div>
                <div class="receipt-warning-text">CONSERVE ESTE RECIBO<br>Pres√©ntelo para recuperar su dep√≥sito cuando devuelva los libros en buen estado.</div>
              </div>
              <div class="receipt-date">${dateStr} ‚Äî ${timeStr}</div>
              <div class="receipt-thanks">¬°Que el conocimiento ilumine tu camino!</div>
            </div>
            <button class="receipt-close" id="receiptClose">Cerrar</button>
          </div>
        `;
        document.getElementById('receiptClose').onclick = () => {
          document.getElementById('cartModal').classList.remove('open');
        };
      } else {
        const total = cart.reduce((s, b) => s + b.deposito, 0);
        content.innerHTML = `
          <button class="cart-close" id="cartClose">‚úï</button>
          <h3 class="cart-title">üõí Libros Seleccionados</h3>
          ${cart.length === 0 ? '<div class="cart-empty">No hay libros en el carrito</div>' : `
            ${cart.map(item => `
              <div class="cart-item">
                <div class="cart-item-info">
                  <div class="cart-item-name">${item.title}</div>
                  <div class="cart-item-price">${item.deposito} PO</div>
                </div>
                <button class="cart-item-remove" data-id="${item.id}">‚úï</button>
              </div>
            `).join('')}
            <div class="cart-total">
              <span class="cart-total-label">Dep√≥sito Total:</span>
              <span class="cart-total-value">${total} PO</span>
            </div>
            <button class="cart-checkout" id="checkoutBtn">üìú Confirmar Alquiler</button>
          `}
        `;
        document.getElementById('cartClose').onclick = () => {
          document.getElementById('cartModal').classList.remove('open');
        };
        document.querySelectorAll('.cart-item-remove').forEach(btn => {
          btn.onclick = () => { toggleCart(btn.dataset.id); renderCartModal(); };
        });
        const checkoutBtn = document.getElementById('checkoutBtn');
        if (checkoutBtn) {
          checkoutBtn.onclick = () => {
            const receiptData = { items: [...cart], total: cart.reduce((s, b) => s + b.deposito, 0) };
            cart = [];
            updateCartUI();
            renderBooks();
            renderCartModal(true, receiptData);
          };
        }
      }
    }
    
    document.getElementById('cartBtn').onclick = () => {
      renderCartModal();
      document.getElementById('cartModal').classList.add('open');
    };
    
    document.getElementById('cartModal').onclick = (e) => {
      if (e.target.id === 'cartModal') e.target.classList.remove('open');
    };
    
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.onclick = () => {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(btn.dataset.section).classList.add('active');
        btn.classList.add('active');
      };
    });
    
    renderBooks();
  </script>
</body>
</html>